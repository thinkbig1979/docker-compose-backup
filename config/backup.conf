# Docker Stack Selective Sequential Backup Configuration
# This file should be in the same directory as the docker-backup.sh script

# Required: Directory containing Docker compose stacks to backup
# This should be the parent directory containing subdirectories with docker-compose.yml files
BACKUP_DIR=/opt/docker-stacks

# Optional: Backup timeout in seconds
# Default: 3600 (1 hour)
# Increase for larger backup sets
BACKUP_TIMEOUT=3600

# Optional: Docker command timeout in seconds
# Default: 30
# Time to wait for docker compose stop/start commands
DOCKER_TIMEOUT=30

# Required: Restic repository configuration
# Path or URL to the restic repository (local path, sftp, s3, etc.)
RESTIC_REPOSITORY=""

# Required: Restic repository password
# WARNING: This password will be stored in plain text in this config file
# Consider using file permissions (chmod 600) to protect this file
RESTIC_PASSWORD=""

# Optional: Enhanced security - Password file support
# Enable to use a separate file containing the password
# ENABLE_PASSWORD_FILE=true
# RESTIC_PASSWORD_FILE="/path/to/password/file"

# Optional: Enhanced security - Password command support  
# Enable to use a command that outputs the password
# ENABLE_PASSWORD_COMMAND=true
# RESTIC_PASSWORD_COMMAND="gpg --decrypt /path/to/encrypted/password.gpg"

# Optional: Custom hostname for backup identification
# If unset or empty, restic will use the system hostname
# This allows you to identify backups from different environments
# HOSTNAME=""

# Optional: Retention policy configuration
# These settings control how many snapshots to keep when auto-pruning
# If any KEEP_* variable is unset or empty, it will be omitted from the forget command
KEEP_DAILY=7      # Keep 7 daily snapshots
KEEP_WEEKLY=4     # Keep 4 weekly snapshots
KEEP_MONTHLY=12   # Keep 12 monthly snapshots
KEEP_YEARLY=3     # Keep 3 yearly snapshots

# Optional: Auto-prune after successful backups
# When set to true, runs 'restic forget --prune' after each successful backup
# using the retention policy defined above
AUTO_PRUNE=false

#######################################
# Phase 1: Enhanced Security & Verification Options
#######################################

# Optional: Enable backup verification after each backup
# Verifies the integrity of backups immediately after creation
# ENABLE_BACKUP_VERIFICATION=false

# Optional: Verification depth level
# - metadata: Quick verification (just list files)
# - files: Moderate verification (verify file listing, default)
# - data: Deep verification (full data integrity check, slower)
# VERIFICATION_DEPTH=files

# Optional: Minimum required disk space in MB
# Script will fail if available space is below this threshold
# MIN_DISK_SPACE_MB=1024

#######################################
# Phase 2: Performance & Resource Monitoring Options
#######################################

# Optional: Enable performance optimization mode
# Adds restic flags: --one-file-system, --exclude-caches, --exclude-if-present .resticignore
# ENABLE_PERFORMANCE_MODE=false

# Optional: Enable Docker state caching
# Pre-caches Docker states to reduce docker compose API calls during backup
# ENABLE_DOCKER_STATE_CACHE=false

# Optional: Enable system resource monitoring
# Monitors memory and CPU load, warns if resources are constrained
# CHECK_SYSTEM_RESOURCES=false

# Optional: Resource thresholds for monitoring
# MEMORY_THRESHOLD_MB=512  # Minimum free memory in MB
# LOAD_THRESHOLD=80        # Maximum system load percentage

# Optional: Enable parallel processing (experimental)
# Process multiple directories concurrently (may cause resource contention)
# ENABLE_PARALLEL_PROCESSING=false
# MAX_PARALLEL_JOBS=2

# Example configuration for different scenarios:

# Small setup with few containers:
# BACKUP_DIR=/home/user/docker-projects
# BACKUP_TIMEOUT=1800
# DOCKER_TIMEOUT=15
# RESTIC_REPOSITORY=/home/user/backups/docker-restic-repo
# RESTIC_PASSWORD=my-secure-password

# Large production setup:
# BACKUP_DIR=/srv/docker-stacks
# BACKUP_TIMEOUT=7200
# DOCKER_TIMEOUT=60
# RESTIC_REPOSITORY=sftp:backup-server:/srv/backups/docker-restic-repo
# RESTIC_PASSWORD=production-secure-password

# Notes:
# - BACKUP_DIR must exist and be readable
# - Each subdirectory in BACKUP_DIR should contain a docker-compose.yml file
# - RESTIC_REPOSITORY and RESTIC_PASSWORD must be configured in this file
# - The script uses selective, sequential processing - edit .dirlist to control which directories are backed up
# - New directories are disabled by default (opt-in approach)
# - This configuration file must be in the same directory as the docker-backup.sh script
#
# Security Notes:
# - RESTIC_PASSWORD is stored in plain text in this file
# - Protect this file with appropriate permissions: chmod 600 backup.conf
# - Consider using a dedicated backup user with limited privileges
# - Environment variables RESTIC_REPOSITORY and RESTIC_PASSWORD are used as fallback
#   if not specified in this config file (for backward compatibility)